version: '3.6'
services:

  api:
    build:
      context: .
      dockerfile: Dockerfile-api
    image: liipi-api
    environment:
      PSQL_USERNAME: liipi
      PSQL_PASSWORD: liipi
      PSQL_HOST: db:5432

  web:
    build:
      context: web
      dockerfile: Dockerfile-web
    image: liipi-web
    environment:
      API_URL: http://api:8080
    ports:
      - "8080:80"

  test:
    build:
      context: test
      dockerfile: Dockerfile-test
    image: liipi-test
    environment:
      BASEURL: http://web/

  db:
    build:
      context: db
      dockerfile: Dockerfile-db
    image: liipi-db
    environment:
      POSTGRES_USER: liipi
      POSTGRES_PASSWORD: liipi
    ports:
      - "5432:5432"
