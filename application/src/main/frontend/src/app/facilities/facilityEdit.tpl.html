<form name="editFacilityForm" class="form-horizontal" role="form" novalidate>
<main-layout>

<headline>
	{{ editCtrl.facility.name.fi || ('facilities.name.placeholder' | translate) }}
</headline>
<actions>
	<facility-edit-navi></facility-edit-navi>
</actions>

<content>
<div class="wdFacilityEditView">

<div class="row">
	<h3 class="h3-first">{{"facilities.basic_info" | translate}}</h3>
</div>

<div class="row">
	<label>{{ "facilities.name.label" | translate }} *</label>
</div>
<div class="row">
	<multilingual-edit name="name" ng-model="editCtrl.facility.name" mandatory="true"></multilingual-edit>
</div>
<div class="row">
	<div class="form-group">
		<label>{{ "facilities.aliases.label" | translate }}</label>
		<div class="wdAliases">
			<tags ng-model="editCtrl.facility.aliases" placeholder="{{ 'facilities.aliases.placeholder' | translate }}"></tags>
		</div>
	</div>
</div>

<div class="row">
	<label>{{"operators.label" | translate}} *</label>
</div>
<div class="row">
	<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 column first-column">
		<operator-select object="editCtrl.facility" mandatory="true"></operator-select>
	</div>
</div>

<div class="row">
	<h3>{{"facilities.location" | translate}} *</h3>
	<div class="btn-group">
		<label id="editModeLocation" class="btn btn-xs" ng-model="editCtrl.editMode" btn-radio="'location'">Määritä sijainti</label>
		<label id="editModePorts" class="btn btn-xs" ng-model="editCtrl.editMode" btn-radio="'ports'">Määritä sisään- ja uloskäynnit</label>
	</div>
	<div class="map-container">
		<facility-map name="facilityMap" ng-model="editCtrl.facility" edit-mode="editCtrl.editMode"
					  no-tiles="{{features['mapNoTiles']}}" show-errors="{ instant: true }"></facility-map>
	</div>
</div>

<div class="row">
	<h3>{{"facilities.capacity.heading" | translate}}</h3>
	<h4>{{"facilities.capacity.built" | translate}}</h4>
</div>
<div class="row">
	<div class="column2 first-column">
		<div class="panel panel-default">
			<table class="table table-bordered table-striped table-condensed">
				<thead>
				<tr>
					<th translate="facilities.capacity.type"></th>
					<th translate="facilities.capacity.built"></th>
				</tr>
				</thead>
				<tbody>
				<tr ng-repeat="capacityType in editCtrl.capacityTypes">
					<td class="wdCapacityType">{{'capacity-types.' + capacityType + '.label' | translate}}</td>
					<td>
						<input name="builtCapacity{{capacityType}}" type="number" class="form-control capacityInput"
							   ng-model="editCtrl.facility.builtCapacity[capacityType]"
							   min="0" show-errors>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>

<div class="rowWithMargin">
		<h4 translate="facilities.pricing.label"></h4>
		<p  ng-hide="editCtrl.hasPricingRows()">Pysäköintipaikkaan ei ole lisätty kapasiteettirivejä</p>
		<div class="panel panel-default row" ng-show="editCtrl.hasPricingRows()">
			<table class="table table-bordered table-striped table-condensed">
				<thead>
				<tr>
					<th></th>
					<th colspan="3">
						Kapasiteetti
					</th>
					<th colspan="4">
						Aukioloaika
					</th>
					<th colspan="4">
						Hinta
					</th>
				</tr>
				<tr>
					<th class="centeredCell"><input type="checkbox" ng-model="allSelected" class="checkbox"/></th>
					<th id="facilities-pricing-capacityType" translate="facilities.pricing.capacityType"></th>
					<th id="facilities-pricing-usage" translate="facilities.pricing.usage"></th>
					<th id="facilities-pricing-maxCapacity" translate="facilities.pricing.maxCapacity"></th>

					<th id="facilities-pricing-dayType" translate="facilities.pricing.dayType"></th>
					<th translate="facilities.pricing.h24"></th>
					<th id="facilities-pricing-from" translate="facilities.pricing.from"></th>
					<th id="facilities-pricing-until" translate="facilities.pricing.until"></th>

					<th translate="facilities.pricing.free"></th>
					<th translate="facilities.pricing.price.fi"></th>
					<th translate="facilities.pricing.price.sv"></th>
					<th translate="facilities.pricing.price.en"></th>
				</tr>
				</thead>
				<tbody>
				<tr ng-repeat="pricing in editCtrl.facility.pricing" pricing-edit pricing="pricing" selections="selections"
					class="{{selections[pricing._id] ? 'selected' : 'unselected'}}"></tr>
				</tbody>
			</table>
		</div>
</div>

<div class="rowWithMargin">
	<div class="column first-column">
		<a class="btn btn-xs btn-responsive" role="button" ng-click="editCtrl.addPricingRow()">
			{{'facilities.action.addPricingRow' | translate }}
		</a>
		<a class="btn btn-xs btn-responsive" role="button" ng-click="editCtrl.clonePricingRows()"
		   ng-show="editCtrl.hasPricingRows()">
			{{'facilities.action.clonePricingRows' | translate }}
		</a>
		<a class="btn btn-xs btn-responsive" role="button" ng-click="editCtrl.removePricingRows()"
		   ng-show="editCtrl.hasPricingRows()">
			{{'facilities.action.removePricingRows' | translate }}
		</a>
	</div>
</div>

<div class="row">
	<h3>{{"facilities.contacts.heading" | translate}}</h3>
</div>
<div class="row">
	<div class="column3 first-column">
		<facility-contact-edit contact-type="emergency" facility-contacts="editCtrl.facility.contacts"
							   operator-id="editCtrl.facility.operatorId" mandatory="true"></facility-contact-edit>
	</div>
</div>
<div class="row">
	<div class="column3 first-column">
		<facility-contact-edit contact-type="operator" facility-contacts="editCtrl.facility.contacts"
							   operator-id="editCtrl.facility.operatorId" mandatory="true"></facility-contact-edit>
	</div>
</div>
<div class="row">
	<div class="column3 first-column">
		<facility-contact-edit contact-type="service" facility-contacts="editCtrl.facility.contacts"
							   operator-id="editCtrl.facility.operatorId"></facility-contact-edit>
	</div>
</div>

<div class="row"><h3>{{"facilities.paymentInfo.heading" | translate }}</h3></div>
<div class="row">
	<div class="form-group">
		<label class="checkbox-label">
			<input type="checkbox" class="checkbox" ng-model="editCtrl.facility.paymentInfo.parkAndRideAuthRequired" />
			{{ "facilities.paymentInfo.parkAndRideAuthRequired" | translate }}
		</label>
	</div>
</div>
<div class="row">
	<div class="form-group">
		<label>{{ "facilities.paymentInfo.paymentMethods.label" | translate }}</label>
		<ui-select multiple ng-model="editCtrl.facility.paymentInfo.paymentMethodIds" theme="bootstrap" ng-disabled="disabled" reset-search-input="true">
			<ui-select-match placeholder="{{'facilities.paymentInfo.methodPlaceholder' | translate }}">{{$item.name.fi}}</ui-select-match>
			<ui-select-choices repeat="paymentMethod.id as paymentMethod in editCtrl.paymentMethods | filter: {name: {fi: $select.search}}">
				<div ng-bind-html="paymentMethod.name.fi | highlight: $select.search"></div>
			</ui-select-choices>
		</ui-select>
	</div>
</div>
<div class="row"><label>{{ "facilities.paymentInfo.detail.label" | translate }}</label></div>
<div class="row">
	<long-multilingual-edit name="paymentInfoDetail" ng-model="editCtrl.facility.paymentInfo.detail"></long-multilingual-edit>
</div>
<div class="row"><label>{{ "facilities.paymentInfo.url.label" | translate }}</label></div>
<div class="row">
	<multilingual-edit name="paymentInfoUrl" ng-model="editCtrl.facility.paymentInfo.url"></multilingual-edit>
</div>

<div class="row">
	<h3>{{"facilities.serviceIds.heading" | translate}}</h3>
	<div>
		<ui-select multiple ng-model="editCtrl.facility.serviceIds" theme="bootstrap" ng-disabled="disabled" reset-search-input="true">
			<ui-select-match placeholder="Valitse palvelut...">{{$item.name.fi}}</ui-select-match>
			<ui-select-choices repeat="service.id as service in editCtrl.services | filter: {name: {fi: $select.search}}">
				<div ng-bind-html="service.name.fi | highlight: $select.search"></div>
			</ui-select-choices>
		</ui-select>
	</div>
</div>
</div>
</content>
</main-layout>
</form>
